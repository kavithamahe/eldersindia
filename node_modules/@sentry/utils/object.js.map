{"version":3,"file":"object.js","sourceRoot":"","sources":["src/object.ts"],"names":[],"mappings":"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","sourcesContent":["import { isPlainObject } from './is';\n\n/**\n * Just an Error object with arbitrary attributes attached to it.\n */\ninterface ExtendedError extends Error {\n  [key: string]: any;\n}\n\n/**\n * Transforms Error object into an object literal with all it's attributes\n * attached to it.\n *\n * Based on: https://github.com/ftlabs/js-abbreviate/blob/fa709e5f139e7770a71827b1893f22418097fbda/index.js#L95-L106\n *\n * @param error An Error containing all relevant information\n * @returns An object with all error properties\n */\nfunction objectifyError(error: ExtendedError): object {\n  // These properties are implemented as magical getters and don't show up in `for-in` loop\n  const err: {\n    stack: string | undefined;\n    message: string;\n    name: string;\n    [key: string]: any;\n  } = {\n    message: error.message,\n    name: error.name,\n    stack: error.stack,\n  };\n\n  for (const i in error) {\n    if (Object.prototype.hasOwnProperty.call(error, i)) {\n      err[i] = error[i];\n    }\n  }\n\n  return err;\n}\n\n/**\n * Serializer function used as 2nd argument to JSON.serialize in `serialize()` util function.\n */\nfunction serializer(): (key: string, value: any) => any {\n  const stack: any[] = [];\n  const keys: string[] = [];\n  const cycleReplacer = (_: string, value: any) => {\n    if (stack[0] === value) {\n      return '[Circular ~]';\n    }\n    return `[Circular ~.${keys.slice(0, stack.indexOf(value)).join('.')}]`;\n  };\n\n  return function(this: any, key: string, value: any): any {\n    let currentValue: any = value;\n\n    if (stack.length > 0) {\n      const thisPos = stack.indexOf(this);\n\n      if (thisPos !== -1) {\n        stack.splice(thisPos + 1);\n        keys.splice(thisPos, Infinity, key);\n      } else {\n        stack.push(this);\n        keys.push(key);\n      }\n\n      if (stack.indexOf(currentValue) !== -1) {\n        currentValue = cycleReplacer.call(this, key, currentValue);\n      }\n    } else {\n      stack.push(currentValue);\n    }\n\n    return currentValue instanceof Error ? objectifyError(currentValue) : currentValue;\n  };\n}\n\n/**\n * Serializes the given object into a string.\n * Like JSON.stringify, but doesn't throw on circular references.\n * Based on a `json-stringify-safe` package and modified to handle Errors serialization.\n *\n * The object must be serializable, i.e.:\n *  - Only primitive types are allowed (object, array, number, string, boolean)\n *  - Its depth should be considerably low for performance reasons\n *\n * @param object A JSON-serializable object.\n * @returns A string containing the serialized object.\n */\nexport function serialize<T>(object: T): string {\n  return JSON.stringify(object, serializer());\n}\n\n/**\n * Deserializes an object from a string previously serialized with\n * {@link serialize}.\n *\n * @param str A serialized object.\n * @returns The deserialized object.\n */\nexport function deserialize<T>(str: string): T {\n  return JSON.parse(str) as T;\n}\n\n/**\n * Creates a deep copy of the given object.\n *\n * The object must be serializable, i.e.:\n *  - It must not contain any cycles\n *  - Only primitive types are allowed (object, array, number, string, boolean)\n *  - Its depth should be considerably low for performance reasons\n *\n * @param object A JSON-serializable object.\n * @returns The object clone.\n */\nexport function clone<T>(object: T): T {\n  return deserialize(serialize(object));\n}\n\n/**\n * Wrap a given object method with a higher-order function\n * and keep track of the original within `track` array\n *\n * @param source An object that contains a method to be wrapped.\n * @param name A name of method to be wrapped.\n * @param replacement A function that should be used to wrap a given method.\n * @param [track] An array containing original methods that were wrapped.\n * @returns void\n */\n\nexport function fill(\n  source: { [key: string]: any },\n  name: string,\n  replacement: (...args: any[]) => any,\n  track?: Array<[{ [key: string]: any }, string, any]>,\n): void {\n  const orig = source[name];\n  source[name] = replacement(orig);\n  // tslint:disable-next-line:no-unsafe-any\n  source[name].__raven__ = true;\n  // tslint:disable-next-line:no-unsafe-any\n  source[name].__orig__ = orig;\n  if (track) {\n    track.push([source, name, orig]);\n  }\n}\n\n/**\n * Encodes given object into url-friendly format\n *\n * @param object An object that contains serializable values\n * @returns string Encoded\n */\nexport function urlEncode(object: { [key: string]: any }): string {\n  return Object.keys(object)\n    .map(\n      // tslint:disable-next-line:no-unsafe-any\n      key => `${encodeURIComponent(key)}=${encodeURIComponent(object[key])}`,\n    )\n    .join('&');\n}\n\n// Default Node.js REPL depth\nconst MAX_SERIALIZE_EXCEPTION_DEPTH = 3;\n// TODO: Or is it 200kb? 🤔 — Kamil\n// 50kB, as 100kB is max payload size, so half sounds reasonable\nconst MAX_SERIALIZE_EXCEPTION_SIZE = 50 * 1024;\nconst MAX_SERIALIZE_KEYS_LENGTH = 40;\n\n/**\n * TODO\n */\nfunction utf8Length(value: string): number {\n  // tslint:disable-next-line:no-bitwise\n  return ~-encodeURI(value).split(/%..|./).length;\n}\n\n/**\n * TODO\n */\nfunction jsonSize(value: any): number {\n  return utf8Length(JSON.stringify(value));\n}\n\n/**\n * TODO\n */\nfunction serializeValue<T>(value: T): T | string {\n  const maxLength = 40;\n\n  if (typeof value === 'string') {\n    return value.length <= maxLength ? value : `${value.substr(0, maxLength - 1)}\\u2026`;\n  } else if (typeof value === 'number' || typeof value === 'boolean' || typeof value === 'undefined') {\n    return value;\n  }\n\n  const type = Object.prototype.toString.call(value);\n\n  // Node.js REPL notation\n  if (type === '[object Object]') {\n    return '[Object]';\n  }\n  if (type === '[object Array]') {\n    return '[Array]';\n  }\n  if (type === '[object Function]') {\n    const name = ((value as any) as (() => void)).name;\n    return name ? `[Function: ${name}]` : '[Function]';\n  }\n\n  return value;\n}\n\n/**\n * TODO\n */\nfunction serializeObject<T>(value: T, depth: number): T | string | {} {\n  return value;\n\n  if (depth === 0) {\n    return serializeValue(value);\n  }\n\n  if (isPlainObject(value)) {\n    const serialized: { [key: string]: any } = {};\n    const val = value as {\n      [key: string]: any;\n    };\n\n    Object.keys(val).forEach((key: string) => {\n      serialized[key] = serializeObject(val[key], depth - 1);\n    });\n\n    return serialized;\n  } else if (Array.isArray(value)) {\n    const val = (value as any) as T[];\n    return val.map(v => serializeObject(v, depth - 1));\n  }\n\n  return serializeValue(value);\n}\n\n/**\n * TODO\n */\nexport function limitObjectDepthToSize<T>(\n  object: { [key: string]: any },\n  depth: number = MAX_SERIALIZE_EXCEPTION_DEPTH,\n  maxSize: number = MAX_SERIALIZE_EXCEPTION_SIZE,\n): T {\n  const serialized = serializeObject(object, depth);\n\n  if (jsonSize(serialize(serialized)) > maxSize) {\n    return limitObjectDepthToSize(object, depth - 1);\n  }\n\n  return serialized as T;\n}\n\n/**\n * TODO\n */\nexport function serializeKeysToEventMessage(keys: string[], maxLength: number = MAX_SERIALIZE_KEYS_LENGTH): string {\n  if (!keys.length) {\n    return '[object has no keys]';\n  }\n\n  if (keys[0].length >= maxLength) {\n    return keys[0];\n  }\n\n  for (let includedKeys = keys.length; includedKeys > 0; includedKeys--) {\n    const serialized = keys.slice(0, includedKeys).join(', ');\n    if (serialized.length > maxLength) {\n      continue;\n    }\n    if (includedKeys === keys.length) {\n      return serialized;\n    }\n    return `${serialized}\\u2026`;\n  }\n\n  return '';\n}\n"]}